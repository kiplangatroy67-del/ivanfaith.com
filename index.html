<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Romance for Ivan Chat</title>
<style>
  body { font-family: Arial, sans-serif; background: #fef6f6; padding: 20px; }
  #chat { border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: auto; background: #fff; }
  .message { margin: 5px 0; padding: 5px 10px; border-radius: 10px; max-width: 70%; }
  .self { background: #dcf8c6; text-align: right; margin-left: auto; }
  .other { background: #eee; text-align: left; margin-right: auto; }
  .time { font-size: 0.7em; color: #666; display: block; margin-top: 3px; }
  input, button { padding: 5px; margin: 5px 0; }
</style>
</head>
<body>

<h2>Romance for Ivan Chat</h2>

<input type="text" id="userName" placeholder="Enter your name"><br>
<input type="text" id="chatInput" placeholder="Type your message">
<input type="file" id="chatFile" accept="image/*">
<button id="sendBtn">Send</button>

<div id="chat"></div>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script>
  // ==== Firebase Config ====
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    databaseURL: "YOUR_DB_URL",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_BUCKET",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const messagesRef = db.ref("romanceForIvan");

  // ==== Name Persistence ====
  const userName = document.getElementById("userName");
  const storedName = localStorage.getItem("chatName");
  if(storedName) userName.value = storedName;

  userName.addEventListener("change", () => {
    localStorage.setItem("chatName", userName.value.trim());
  });

  // ==== Send Message ====
  const chatInput = document.getElementById("chatInput");
  const chatFile = document.getElementById("chatFile");
  const sendBtn = document.getElementById("sendBtn");
  const chatDiv = document.getElementById("chat");

  sendBtn.addEventListener("click", () => {
    const text = chatInput.value.trim();
    if(!text && !chatFile.files.length) return;

    const name = userName.value.trim() || "Anonymous";
    if(chatFile.files.length){
      const reader = new FileReader();
      reader.onload = () => {
        pushMessage(name, text, reader.result);
      };
      reader.readAsDataURL(chatFile.files[0]);
    } else {
      pushMessage(name, text, null);
    }

    chatInput.value = "";
    chatFile.value = "";
  });

  function pushMessage(name, text, media){
    messagesRef.push({
      from: name,
      text,
      media,
      time: new Date().toLocaleTimeString()
    });
  }

  // ==== Display Messages ====
  messagesRef.on("child_added", snapshot => {
    const msg = snapshot.val();
    const div = document.createElement("div");
    const self = msg.from === (userName.value.trim() || "Anonymous");
    div.className = "message " + (self ? "self" : "other");

    div.innerHTML = `<strong>${msg.from}</strong>: ${msg.text || ""}` +
                    (msg.media ? `<br><img src="${msg.media}" width="100">` : "") +
                    `<span class="time">${msg.time}</span>`;
    chatDiv.appendChild(div);
    chatDiv.scrollTop = chatDiv.scrollHeight;
  });
</script>

</body>
</html>
